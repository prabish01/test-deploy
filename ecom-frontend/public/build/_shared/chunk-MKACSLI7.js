import{c as d}from"/build/_shared/chunk-G5EWVEI5.js";import{a as S,c as p}from"/build/_shared/chunk-VEH472QX.js";import{c as R,d as l}from"/build/_shared/chunk-2QEWK57A.js";var y=R((H,m)=>{m.exports={}});var f=typeof process>"u";async function h(e){return import(e.split("").join(""))}var g=l(y(),1);async function q(){return f?g.createCookieSessionStorage:h("@remix-run/node").then(e=>e.createCookieSessionStorage)}var s;async function c(){return s||(s=(await q())({cookie:{name:"vendure_remix_session",httpOnly:!0,path:"/",sameSite:"lax",secrets:["awdbhbjahdbaw"]}}),s)}var k="authToken";async function w(e){let o=new Headers(e.headers),n=e.request;o.append("Content-Type","application/json");let t=await c().then(r=>r.getSession(e.request?.headers.get("Cookie")));if(t){let r=t.get(k);r&&o.append("Authorization",`Bearer ${r}`)}return fetch(d,{method:"POST",body:JSON.stringify(e),headers:o}).then(async r=>({...await r.json(),headers:r.headers}))}var x=p(_),A=x;function _(e,o,n){return w({query:S(e),variables:o,...n}).then(async t=>{let r=t.headers.get("vendure-auth-token"),a={};if(r){let u=await c(),i=await u.getSession(n?.request?.headers.get("Cookie"));i&&(i.set(k,r),a["Set-Cookie"]=await u.commitSession(i))}if(a["x-vendure-api-url"]=d,t.errors)throw console.log(t.errors[0].extensions?.exception?.stacktrace.join(`
`)??t.errors),new Error(JSON.stringify(t.errors[0]));return{...t.data,_headers:new Headers(a)}})}export{A as a};
